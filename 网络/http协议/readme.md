# HTTP协议（超文本传输协议）

协议就是一个统一的标准。超文本包括文本、脚本、样式表、图片、多媒体信息（视频、音乐等）。HTTP是一种传输协议，主要给浏览器服务，网站是基于HTTP协议的。

http是应用层协议、无状态协议。

两种动作：request、response

HTTP协议是由从客户机到服务器的请求(Request)和从服务器到客户机的响应(response)进行约束和规范。

## 发展历史
- 1991 HTTP/0.9
- 1996 HTTP/1.0
- 1999 HTTP/1.1
- 2015 HTTP/2

# TCP/IP协议栈
![UOWu9S.png](https://s1.ax1x.com/2020/07/23/UOWu9S.png)

TCP/IP是事实上的协议。（4层/5层）
1. 应用层
   
   - 为用户提供所需要的各种服务，如：HTTP、FTP、DNS、SMTP等。
2. 传输层
   
   - 为应用层实体提供端到端的通信功能，保证数据包的顺序传送及数据的完整性。
   - TCP（传输控制协议，可靠协议，保证数据被接收）和UDP（用户数据报协议，不可靠协议，没有连接状态，只负责发，不确认结果）
3. 网络层
   
   - 主要解决主机到主机的通信问题。ip地址分配、PPP协议（建立通信链路）。
4. 数据链路层
   
   - 在物理上传输信号，将数字信号调制成光信号、电信号、无线电信号等，在物理层上进行传播。如网卡。
5. 物理层
   
   - 网线、无线电，是一个载体

4层时，将数据链路层和物理层划为一层（网络接口层），这两层都是硬件要做的事情，负责监视数据在主机和网络之间的交换。

ISO/OSI七层协议，是一种规范，一个建议。

## HTTP协议在TCP/IP协议栈中的位置
![](https://s1.ax1x.com/2020/07/23/UOgJAK.th.jpg)


HTTP 默认端口为80

HTTPS 默认端口为443

# HTTP的工作过程
一次HTTP操作称为一个事务（多个阶段，任意一个阶段失败就失败）。

建立连接（TCP) -> 请求（HTTP）-> 响应（HTTP） -> 断开连接（TCP）

# 请求和响应
请求报文结构

响应报文结构

# 请求方法
- GET（查）：请求获取Request-URI所标识的资源
- POST（改）：在Request-URI所标识的资源后附加新的数据
- PUT（增）：请求服务器存储一个资源，并用Request-URI作为标识
- DELETE（删）
- HEAD：请求获取由Request-URI所标识的资源的响应消息报头（没有响应体）
- TRACE：请求服务器回送收到的请求消息，主要用于测试或诊断（服务状态）
- CONNECT：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器（持久连接）
- OPTIONS：请求查询服务器的性能，或者查询与资源相关的选项和请求
  
日常开发中，一般只用GET、POST。

RESTFUL严格按照请求方法设计接口。

## GET和POST的区别
GET不向服务器请求数据。

# HTTP缓存
浏览器在磁盘上有一块缓存空间，其大小有个上限。
## HTTP缓存优点
- 减少响应延迟
- 减少网络带宽消耗

## 浏览器的强缓存和协商缓存

# HTTPS协议
对称加密：加密手段与解密手段互为逆运算

非对称加密：加密手段与解密手段没有关系

HTTPS采用非对称加密。

协议协商将http转为https。

TLS

# HTTP 2
- 使用二进制格式传输，更高效、更紧凑
- 对报头压缩，降低开销（HTTP1.0只能对报文体压缩）
- 多路复用（长连接的升级），一个网络连接实现并行请求
- 服务器主动推送，减少请求的延迟
  - 在http1.0中，只有客户端发送请求，服务器才能返回数据。如果要实现推送，ajax必须一直向服务器发送请求（轮询），等待服务器响应。而使用HTTP2.0后，ajax技术将不会被用在推送上。
- 默认使用加密（提高安全性）

## HTTP 2的伪头字段
`key`前面加 `:`

# HTTP 3
QUIC协议（Quick UDP Internet Connection）。底层协议基于UDP。 

- HTTP3不是HTTP2的扩展
- 他将会是一个全新的WEB协议
- 目前处于制订和测试阶段

# HTTP与反向代理
局域网（局域网内部互通）、广域网、互联网

局域网 -> 网关/路由器 -> 互联网

## 正向代理的作用
1. 监控流量（网关、正向代理）
   对网站的访问做限制（防火墙、网关、正向代理）
2. 做一些缓存（将服务器上返回的数据暂时存储在代理上）
3. 科学上网

## 反向代理的作用
1. 加密和SSL加速（可以配置HTTPS）
2. 负载均衡（多台服务器跑同一个应用，反向代理做任务分配）
3. 缓存静态内容（静态内容包括图片、脚本、样式表等）
4. 压缩（浏览器通过识别响应头解压）
5. 减速上传
6. 安全（在Internet和Web server之间加了一层Proxy）
7. 外网发布（请求转发）

nginx upstream块（定义变量，目前理解）

负载均衡的配置：
在upstream里面添加server
